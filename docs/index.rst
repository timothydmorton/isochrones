isochrones
=======

``isochrones`` is a Python package built to simplify common tasks that are
often done with stellar model grids, such as simulating synthetic
stellar populations, plotting evolution tracks or isochrones,
or estimating the physical properties of a star
given photometric or spectroscopic observations.  The guts of this
code is a 3-d linear interpolation in mass--age--[Fe/H] space. That is,
the model predicts the various properties as functions of these
inputs.

While ``isochrones`` comes packaged with three different model grids
(Padova, BASTI, and Dartmouth), it can be easily extended to a
user-defined grid.  It uses MultiNest/PyMultiNest for sampling, or `emcee
<http://dan.iel.fm/emcee/current/>`_ for MCMC sampling if (Py)MultiNest
is not installed.

Note that the first time you import any of the pre-packaged model
grids, it will download the required data to a ``~/.isochrones``
folder.

I welcome community feedback to help improve this tool.  The code is
hosted at `GitHub <http://github.com/timothydmorton/isochrones>`_;
please feel free to contribute. 

.. note::

  New in v0.9, fitting is now done by default using MultiNest, if 
  available on your system via PyMultiNest.  If you wish to take 
  advantage of this (highly recommended) feature, you can follow
  `these <http://astrobetter.com/wiki/MultiNest+Installation+Notes>`_
  instructions for installing MultiNest and PyMultinest.  If you do 
  not have MultiNest available, the fits should still work using ``emcee``.

.. warning::
  
  Also note that there was a bug in the ``dartmouth.tri`` triangulation
  file in versions prior to 0.9.  So if you've previously installed 
  ``isochrones`` and upgrade to 0.9, you should be prompted to delete
  this file so it can be re-installed.

Installation
------------

To install, you can get the most recently released version from PyPI::

    pip install isochrones

Or you can clone from github::

    git clone https://github.com/timothydmorton/isochrones.git
    cd isochrones
    python setup.py install

The last command may require ``--user`` if you don't have root privileges.

Basic Usage
---------

To find, for example, what a stellar model grid predicts for stellar
radius at a given mass, log(age), and metallicity::

    >>> from isochrones.dartmouth import Dartmouth_Isochrone
    >>> dar = Dartmouth_Isochrone()
    >>> dar.radius(1.0, 9.7, 0.0) #M/Msun, log10(age), Fe/H
        1.0160123968403469

Importantly (for purposes of synthesizing populations of stars, e.g.),
you can pass array-like values, rather than single values::

    >>> dar.radius([0.8, 1.0, 1.2], 9.7, 0.0)
        array([ 0.75105438,  1.0160124 ,  1.77470954])

Fitting Stellar Properties
------------------------

If you want to estimate physical parameters for a star for which you
have measured spectroscopic properties, you would do something like
the following:

.. code-block:: python

    from isochrones import StarModel
    from isochrones.dartmouth import Dartmouth_Isochrone

    #spectroscopic properties (value, uncertainty)
    Teff = (5770, 80)
    logg = (4.44, 0.08)
    feh = (0.00, 0.10)

    # StarModel needs at least one apparent mag
    V = (4.86,0.02) # M_V for sun (Peacut and Mamajek 2013)

    dar = Dartmouth_Isochrone()

    model  = StarModel(dar, Teff=Teff, logg=logg, feh=feh, V=V)
    model.fit()
    
    # Distance should come out to 10pc

Adding in a Parallax
--------------------


.. code-block:: python

    #spectroscopic properties (value, uncertainty)
    Teff = (5770, 80)
    feh = (0.00, 0.10)

    V = (4.86,0.02) # M_V for sun (Peacut and Mamajek 2013)
    parallax=(100,1) # Paralax in mas
    maxAV = 0.01
    dar = Dartmouth_Isochrone()
    
    model  = StarModel(
        dar, Teff=Teff, feh=feh, V=V, parallax=parallax,maxAV=0.01
	)
    model.fit()

    # Radius should come out to 1 solar radius.


The model now has a ``samples`` property that contains all of the
samples generated by the MultiNest/MCMC chain in a :class:`pandas.DataFrame`
object---or more specifically, it contains both the samples generated
directly from the chain and the corresponding values of all the model
properties (e.g. radius, synthetic photometry, etc.) evaluated at each
chain link.  If you have installed the handy `triangle
<https://github.com/dfm/triangle.py>`_ module, you can also
visualize the results:

.. code-block:: python

   model.triangle()

Note that a :class:`isochrones.StarModel` can be initialized with any arguments
that correspond to properties predicted by the model grids---that is,
in addition to spectroscopic properties, apparent magnitudes (and
errors) may also be included among the keyword arguments.

If apparent magnitudes are included among the properties, then a call
to :func:`isochrones.StarModel.fit` will fit for distance and extinction as
well as mass, age, and [Fe/H].  In this case, you may also set
the ``maxAV`` argument to an appropriate value (1 is default), or the ``min_logg``
argument, if you would like to rule out giant-star fits, for example.

.. note::
  
  New in v0.9, when doing a MultiNest fit, you always will be fitting
  for distance and extinction, so you should always provide at least
  one apparent magnitude.

After running the MultiNest/MCMC chain, you can save the results::

    model.save_hdf('starmodel.h5')

Which you can then read back in later as::

    model = StarModel.load_hdf('starmodel.h5')

In addition, if you would like to entertain the possibility of a star
being having light from more than one component, you can also fit a
:class:`BinaryStarModel` or :class:`TripleStarModel`, if desired.

API Documentation
-----------------

.. toctree::
   :maxdepth: 2

   api
